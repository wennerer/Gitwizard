{%gw_frame --- this is a part of GitWizard}


//The Popup
procedure TFrame1.openfileClick(Sender: TObject);
var aPath,s : string;
    sa      : array of string;
    lv,i    : integer;
begin
 FSender := nil;

 for i := 0 to pred(length(TabSheets)) do
  for lv := 0 to pred(CommandList[i].Count) do
   begin
    if TCommandButton(CommandList[i].Items[lv]).LastClick then FSender := TCommandButton(CommandList[i].Items[lv]);
    TCommandButton(CommandList[i].Items[lv]).LastClick:= false;
   end;


 if FSender = nil then FSender := gitignore;

 if not fileexists(IncludeTrailingPathDelimiter(LazarusIDE.GetPrimaryConfigPath)+ 'gw_options.xml') then
  begin
   showmessage(rs_checkoptionsdialog);
   exit;
  end;

 {$IFDEF WINDOWS}
  aPath := PathToGitWizard+PathDelim+'winCommands'+PathDelim;
  if FSender is TCommandButton then
   begin
    setlength(sa,1);
    sa[0] := aPath+(FSender as TCommandButton).FileName+'.bat';
    if not RunCommand(FEditor,sa,s,[],swoNone) then showmessage(s);
   end;

 {$ENDIF}
 {$IFDEF Linux}
 aPath := PathToGitWizard+PathDelim+'linuxCommands'+PathDelim;
  if FSender is TCommandButton then
   begin
    setlength(sa,1);
    sa[0] := aPath+(FSender as TCommandButton).FileName+'.sh';
    if not RunCommand(FEditor,sa,s,[],swoNone) then showmessage(s);
   end;

 {$ENDIF}
 if FSender = gitignore then
   if not OpenDocument(PathToGitDirectory+PathDelim+'.gitignore') then showmessage(rs_ignorenofound);
end;


procedure TFrame1.deletecommandClick(Sender: TObject);
var aPath        : string;
    lv,i,aTag,j  : integer;
begin
 FSender := nil;
 for i := 0 to pred(length(TabSheets)) do
  for lv := 0 to pred(CommandList[i].Count) do
   begin
    if TCommandButton(CommandList[i].Items[lv]).LastClick then
     begin
      FSender := TCommandButton(CommandList[i].Items[lv]);
      aTag    := TCommandButton(CommandList[i].Items[lv]).Tag;
      j       := i;
     end;
    TCommandButton(CommandList[i].Items[lv]).LastClick:= false;
   end;
 if FSender = nil then FSender := gitignore;

 {$IFDEF WINDOWS}
  aPath := PathToGitWizard+PathDelim+'winCommands'+PathDelim;
  if FSender is TCommandButton then
   if deletefile(aPath+(FSender as TCommandButton).FileName+'.bat') then showmessage('Okay')
   else showmessage(rs_filenotfound);
 {$ENDIF}
 {$IFDEF Linux}
  aPath := PathToGitWizard+PathDelim+'linuxCommands'+PathDelim;
  if FSender is TCommandButton then
   if deletefile(aPath+(FSender as TCommandButton).FileName+'.sh') then showmessage('Okay')
   else showmessage(rs_filenotfound);
 {$ENDIF}

 if FSender = gitignore then
  if deletefile(PathToGitDirectory+PathDelim+'.gitignore') then showmessage('Okay')
  else showmessage(rs_filenotfound);
 Checkgitignore;

 if FSender <> gitignore then
  begin
   CommandList[j].Delete(aTag);//((FSender as TCommandButton).Tag);
   AdjustTheButtons;
   for lv := 0 to pred(CommandList[j].Count) do TCommandButton(CommandList[j].Items[lv]).Tag:=lv;
   WriteValues;
  end;
 Checkgitinit;
end;

procedure TFrame1.movebuttonClick(Sender: TObject);
var lv,i,aTag,j,k : integer;
begin
  FSender := nil;
 for i := 0 to pred(length(TabSheets)) do
  for lv := 0 to pred(CommandList[i].Count) do
   begin
    if TCommandButton(CommandList[i].Items[lv]).LastClick then
     begin
      FSender := TCommandButton(CommandList[i].Items[lv]);
      aTag    := TCommandButton(CommandList[i].Items[lv]).Tag;
      j       := i;   showmessage(inttostr(i));
     end;
    TCommandButton(CommandList[i].Items[lv]).LastClick:= false;
   end;
 if FSender = nil then exit;

 MoveButtonForm  := TMoveButtonForm.Create(self);
 try
  MoveButtonForm.SpinEdit1.MaxValue := pred(CommandList[j].Count);
  if j=0 then MoveButtonForm.SpinEdit1.MinValue:= 1
  else MoveButtonForm.SpinEdit1.MinValue:= 0;
  MoveButtonForm.SpinEdit1.Value    := aTag;//(FSender as TCommandButton).Tag;

  MoveButtonForm.ShowModal;

  k := MoveButtonForm.SpinEdit1.Value;
 finally
  MoveButtonForm.Free;
 end;

 CommandList[j].Move(aTag,k);//FSender as TCommandButton).Tag,k);
 AdjustTheButtons;
 for lv := 0 to pred(CommandList[j].Count) do TCommandButton(CommandList[j].Items[lv]).Tag:=lv;
 writeValues;
end;

procedure TFrame1.movetotabClick(Sender: TObject);
var lv : integer;
begin
 FSender := nil;
 for lv := 0 to pred(CommandList[0].Count) do
  begin
   if TCommandButton(CommandList[0].Items[lv]).LastClick then FSender := TCommandButton(CommandList[0].Items[lv]);
   TCommandButton(CommandList[0].Items[lv]).LastClick:= false;
  end;
 if FSender = nil then exit;
 //showmessage((FSender as TCommandButton).FileName);
 (FSender as TCommandButton).Parent := TabSheets[0];
 //AdjustTheButtons;
end;


